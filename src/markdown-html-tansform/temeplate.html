<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /*style*/
    </style>
    <title>Markdown</title>
</head>

<body>
    <!-- sidebar为侧边栏区域，请不要更改 -->
    <div class="sidebar">
        <div class="sidebar-title">
            <span>by CodeGorgeous</span>
        </div>
        <div class="sidebar-content"></div>
    </div>
    <div class="markdown-box">
        <div class="content">
            <span class="loading-lock">展开>></span>
            <!-- content -->
        </div>
    </div>
    <!-- 回到顶部按钮 -->
    <div class="backTop">Top</div>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        /**
         * TODO: 获取所有h1和h2标签
         *  1: h1和h2标签的特点就是拥有id值
         *  2: 可以根据id值进行对元素进行筛选
         *  3: 筛选出的元素应该是具有一定的顺序然后正常渲染到侧边栏即可
         */
        const oH1s = $('h1');
        const oH2s = $('h2');
        const sidebar = $('.sidebar-content')
        let createAs = ''
        let index = 1
        const oDomAll = $('.content *');
        let oIdDom = [];
        for (let i = 0; i < oDomAll.length; i++) {
            if ($(oDomAll[i]).attr('id')) {
                oIdDom.push(oDomAll[i]);
                createAs += `<div><a class="${oDomAll[i].localName}" href='#${$(oDomAll[i]).attr('id')}'>${oDomAll[i].outerText}</a></div>`
            }
        }
        sidebar.eq(0).append(createAs);

        // 控制侧边栏显示与隐藏
        const oLock = $('.loading-lock')
        const oSideBar = $('.sidebar')
        const oContent = $('.content')

        let lock = false // 默认侧边栏不显示
        oLock.on('click', () => {
            if (!lock) { // 缩小
                oSideBar.css('left', '0')
                oContent.css('margin-left', '300px')
                oLock.text('<< 隐藏')
                lock = true
            } else {
                oSideBar.css('left', '-300px')
                oContent.css('margin-left', '0')
                oLock.text('展开 >>')
                lock = false
            }
        })

        // 设置侧边栏默认选中
        if ($('a')) {
            $($('a')[0]).css('color', '#ff6600');
        }

        // 回到顶部
        let oAs = $('.sidebar-content a')
        let windowHeight = window.innerHeight;
        let scrollTop;
        let current;
        window.addEventListener('scroll', (e) => {
            scrollTop = $(document).scrollTop();
            if (scrollTop - windowHeight > 100) {
                $('.backTop').css('display', 'inline-block')
            } else {
                $('.backTop').css('display', 'none')
            }
            // 侧边栏某个元素是否亮起
            const htmlScroolTop = []
            for (const iterator of oIdDom) {
                let distance = iterator.offsetTop - scrollTop
                htmlScroolTop.push(Math.abs(distance))
            }
            const reslt = Math.min(...htmlScroolTop)
            const index = htmlScroolTop.indexOf(reslt) + ''
            current = oAs[index]
            for (const iterator of oAs) {
                iterator.style.color = '#0099ff'
            }
            current.style.color = '#ff6600'
        })


        $('.backTop').on('click', () => {
            let timer = null;
            if (scrollTop - windowHeight > 100) { // 说明现在不处于页面顶部，点击应该scroll为0
                const timeAll = 100; // 1s内3步移动到顶部
                const distance = scrollTop / timeAll;
                timer = setInterval(() => {
                    if (scrollTop <= 0) {
                        scrollTop = 0
                        $(document).scrollTop(scrollTop)
                        clearInterval(timer)
                    } else {
                        scrollTop = scrollTop - distance;
                        $(document).scrollTop(scrollTop)
                    }
                }, 1000 / timeAll);
            }
        })
    </script>
</body>

</html>